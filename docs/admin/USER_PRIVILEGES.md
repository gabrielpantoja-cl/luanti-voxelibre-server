# User Privileges Report

**Generado**: 2025-11-15
**Servidor**: luanti.gabrielpantoja.cl:30000
**Base de datos**: `server/worlds/world/auth.sqlite`

## Resumen

Total de usuarios registrados: **29 usuarios**

## Privilegios por Usuario

### 1. gabo (ID: 1) - ADMINISTRADOR PRINCIPAL
```
advancements, announce, areas, arena_admin, ban, basic_privs, bring, creative, debug, fast, fly, give, help_reveal, home, hunger, interact, kick, maphack, mute, noclip, password, privs, protect, protection_bypass, rollback, rollback_check, server, settime, shout, shutdown, spawn, teleport, time, unban, worldedit
```
**Privilegios totales**: 34 (Acceso completo - Admin)

---

### 2. Gabrielsito (ID: 2)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 3. SrAlligator (ID: 3)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 4. pepelomo (ID: 4) - ADMIN RECIENTE
```
advancements, ban, basic_privs, bring, creative, debug, fast, fly, give, home, hunger, interact, kick, mute, noclip, password, privs, rollback_check, server, settime, shout, shutdown, spawn, teleport, time, unban
```
**Privilegios totales**: 26 (Admin completo - Asignado recientemente)

---

### 5. veight (ID: 5)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 6. gaelsin (ID: 6) - ADMIN RECIENTE
```
advancements, ban, basic_privs, bring, creative, debug, fast, fly, give, home, hunger, interact, kick, mute, noclip, password, privs, rollback_check, server, settime, shout, shutdown, spawn, teleport, time, unban
```
**Privilegios totales**: 26 (Admin completo - Asignado recientemente)

---

### 7. mily (ID: 7)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 8. Pepitin (ID: 8)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 9. Poesea (ID: 9)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 10. cami3 (ID: 10)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 11. Jesucho (ID: 11)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 12. Diegop (ID: 12)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 13. loxos (ID: 13) - ADMIN RECIENTE
```
advancements, ban, basic_privs, bring, creative, debug, fast, fly, give, home, hunger, interact, kick, mute, noclip, password, privs, rollback_check, server, settime, shout, shutdown, spawn, teleport, time, unban
```
**Privilegios totales**: 26 (Admin completo - Asignado recientemente)

---

### 14. Felipes2 (ID: 14)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 15. gapi (ID: 15) - ADMIN RECIENTE
```
advancements, ban, basic_privs, bring, creative, debug, fast, fly, give, home, hunger, interact, kick, mute, noclip, password, privs, rollback_check, server, settime, shout, shutdown, spawn, teleport, time, unban
```
**Privilegios totales**: 26 (Admin completo - Asignado recientemente)

---

### 16. _gg (ID: 16)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 17. _nn (ID: 17)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 18. Diegoel (ID: 18)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 19. pepa22 (ID: 19)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 20. Lorens34 (ID: 20)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 21. Gaelsito (ID: 21)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 22. diegochico (ID: 22)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 23. Ramosjael (ID: 23)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 24. nino (ID: 24)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 25. SaturnoElRey (ID: 25)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 26. Diego (ID: 26)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 27. MemeLord (ID: 27)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 28. elChiquitin (ID: 28)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

### 29. Dieguito (ID: 29)
```
advancements, basic_privs, creative, fast, fly, give, home, hunger, interact, noclip, shout, spawn, teleport
```
**Privilegios totales**: 13 (Creative + Teleport)

---

## AnÃ¡lisis de Privilegios

### Niveles de Acceso

#### ðŸ”´ Super Admin (34 privilegios)
- **gabo** - Acceso completo incluyendo `worldedit`, `areas`, `arena_admin`, `protection_bypass`

#### ðŸŸ  Admin Completo (26 privilegios)
- **pepelomo** - Asignado recientemente
- **gaelsin** - Asignado recientemente
- **loxos** - Asignado recientemente
- **gapi** - Asignado recientemente

**Capacidades Admin**:
- `ban`, `kick`, `mute`, `unban` - ModeraciÃ³n
- `server`, `shutdown` - Control del servidor
- `privs`, `password` - GestiÃ³n de usuarios
- `rollback_check` - Anti-griefing
- `settime`, `time` - Control del mundo

#### ðŸŸ¢ Creative Standard (13 privilegios)
- **23 usuarios** - Jugadores regulares con modo creativo

**Capacidades Creative**:
- `creative`, `fly`, `fast`, `noclip` - Modo creativo
- `give` - Obtener items
- `teleport`, `home`, `spawn` - Movilidad
- `interact`, `shout` - InteracciÃ³n bÃ¡sica

---

## ProtecciÃ³n Anti-Griefing

### VoxeLibre Protection System

VoxeLibre incluye protecciÃ³n de construcciones por defecto:

1. **`mcl_spawn` protection**: Ãrea de spawn protegida automÃ¡ticamente
2. **Player ownership**: Los bloques colocados por un jugador estÃ¡n vinculados a ese jugador
3. **Permission system**: Solo el propietario puede modificar/destruir sus bloques

### Privilegios CrÃ­ticos para Anti-Griefing

- **`protection_bypass`**: Solo tiene **gabo** (Super Admin)
  - Permite modificar bloques de otros usuarios
  - Peligroso si se otorga sin cuidado

- **`rollback_check`**: Tienen **5 admins**
  - Permite ver quiÃ©n modificÃ³ bloques
  - Esencial para investigar griefing

### Recomendaciones Actuales

âœ… **ConfiguraciÃ³n segura**:
- Solo gabo tiene `protection_bypass`
- 4 admins pueden investigar griefing con `rollback_check`
- 23 usuarios creative sin privilegios de bypass

âŒ **Problemas potenciales**:
- Los 4 admins pueden usar `/shutdown` (apagar servidor)
- No hay distinciÃ³n entre "moderador" y "admin completo"

---

## Comandos de Consulta Ãštiles

```bash
# Ver todos los usuarios
docker compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite 'SELECT name FROM auth;'

# Ver privilegios de un usuario especÃ­fico
docker compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite 'SELECT GROUP_CONCAT(privilege, ", ") FROM user_privileges WHERE id=(SELECT id FROM auth WHERE name="username");'

# Contar privilegios por usuario
docker compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite 'SELECT a.name, COUNT(up.privilege) as priv_count FROM auth a LEFT JOIN user_privileges up ON a.id = up.id GROUP BY a.name ORDER BY priv_count DESC;'

# Ver quiÃ©n tiene un privilegio especÃ­fico
docker compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite 'SELECT a.name FROM auth a JOIN user_privileges up ON a.id = up.id WHERE up.privilege = "protection_bypass";'
```

---

## Glosario de Privilegios

### Privilegios de Jugador BÃ¡sico
- `interact`: Interactuar con el mundo (colocar/romper bloques)
- `shout`: Hablar en el chat
- `home`: Usar comando `/home`
- `spawn`: Usar comando `/spawn`
- `hunger`: Sistema de hambre habilitado
- `advancements`: Recibir notificaciones de logros

### Privilegios de Modo Creativo
- `creative`: Modo creativo (vida infinita, volar)
- `fly`: Volar libremente
- `fast`: Caminar/correr rÃ¡pido
- `noclip`: Atravesar bloques
- `give`: Obtener items con `/give`
- `teleport`: Teletransportarse con `/teleport`

### Privilegios de ModeraciÃ³n
- `kick`: Expulsar jugadores temporalmente
- `ban`: Banear jugadores permanentemente
- `unban`: Desbanear jugadores
- `mute`: Silenciar jugadores en el chat
- `bring`: Traer jugadores a tu ubicaciÃ³n

### Privilegios de AdministraciÃ³n
- `server`: Comandos de servidor
- `shutdown`: Apagar el servidor
- `privs`: Gestionar privilegios de otros usuarios
- `password`: Cambiar contraseÃ±as de usuarios
- `settime`: Cambiar hora del dÃ­a
- `time`: Ver/modificar tiempo del mundo

### Privilegios de ProtecciÃ³n
- `protect`: Proteger Ã¡reas
- `protection_bypass`: Ignorar protecciones (PELIGROSO)
- `areas`: Gestionar Ã¡reas protegidas
- `rollback`: Revertir cambios
- `rollback_check`: Ver historial de cambios

### Privilegios Especiales
- `worldedit`: Usar WorldEdit (ediciÃ³n masiva de bloques)
- `arena_admin`: Administrar arena PVP
- `debug`: InformaciÃ³n de depuraciÃ³n
- `maphack`: Ver mapa completo
- `announce`: Anuncios especiales
- `help_reveal`: Ver ayuda oculta

---

## Notas

- **Fecha de asignaciÃ³n de admins**: 2025-11-15 (pepelomo, gaelsin, loxos, gapi)
- **Servidor en producciÃ³n**: No se realizÃ³ reinicio durante la investigaciÃ³n
- **Base de datos**: SQLite en `/config/.minetest/worlds/world/auth.sqlite`
- **Jugadores activos**: 29 usuarios registrados en total

---

## âœ… SOLUCIÃ“N APLICADA (2025-11-15)

### AcciÃ³n Tomada

Se revocaron **TODOS** los privilegios de bypass (`areas`, `server`, `protection_bypass`) a **TODOS** los usuarios excepto `gabo`.

### Usuarios Afectados

**14 usuarios** tuvieron privilegios de bypass revocados:
- Gapi
- gabo2
- gaelsin
- julii
- jutaro
- jutaro2010
- loxos
- lulu
- lulu81
- lulululuo
- lulululuo0000
- pepelomo
- pepelomoomomomo
- veight

### Comandos SQL Ejecutados

```sql
DELETE FROM user_privileges WHERE privilege = 'areas' AND id != (SELECT id FROM auth WHERE name = 'gabo');
DELETE FROM user_privileges WHERE privilege = 'server' AND id != (SELECT id FROM auth WHERE name = 'gabo');
DELETE FROM user_privileges WHERE privilege = 'protection_bypass' AND id != (SELECT id FROM auth WHERE name = 'gabo');
```

### Estado Final

**âœ… Solo `gabo` tiene privilegios de bypass**:
- `areas` âœ…
- `server` âœ…
- `protection_bypass` âœ…
- `worldedit` âœ…

**âœ… Admins mantienen privilegios seguros**:
- `ban`, `kick`, `mute` (moderaciÃ³n)
- `privs` (gestiÃ³n de usuarios)
- `creative`, `fly`, `teleport` (gameplay)
- `protect` (crear sus propias Ã¡reas)
- **NO tienen**: `areas`, `server`, `protection_bypass`

### VerificaciÃ³n

```bash
# Verificar que solo gabo tiene bypass
SELECT DISTINCT a.name FROM auth a
JOIN user_privileges up ON a.id = up.id
WHERE up.privilege IN ("areas", "server", "protection_bypass");

# Resultado: gabo
```

### Servidor Reiniciado

- **Fecha**: 2025-11-15 17:32 UTC
- **Estado**: âœ… Funcionando correctamente (healthy)
- **Puerto**: 30000/UDP activo
- **Proceso**: luantiserver corriendo normalmente

### Impacto

**âœ… Las protecciones de Ã¡reas ahora funcionan correctamente**:
- Solo propietarios y miembros autorizados pueden modificar Ã¡reas protegidas
- Los admins NO pueden bypasear protecciones
- "casaloxos" solo editable por gabo y loxos (como miembro)

## PrÃ³ximos Pasos Sugeridos

1. âœ… **Privilegios de bypass corregidos** - COMPLETADO

2. **Documentar Ã¡reas protegidas importantes**:
   - casaloxos: gabo (propietario), loxos (miembro)
   - Otras Ã¡reas existentes

3. **Entrenar admins en sistema de protecciÃ³n**:
   - CÃ³mo crear Ã¡reas con `/protect_here`
   - CÃ³mo agregar miembros con `/area_add_member`
   - Limitaciones sin privilegios de bypass

4. **Establecer polÃ­tica de privilegios**:
   - Jugador â†’ Creative â†’ Moderador â†’ Admin â†’ Super Admin
   - Documentar quÃ© privilegios tiene cada rol

---

## PROBLEMA CRITICO: VoxeLibre Ignora `default_privs` (Feb 2026)

### Descripcion del Problema

El setting `default_privs` en `minetest.conf` **NO funciona con VoxeLibre**. Independientemente de lo que se configure, los usuarios nuevos solo reciben:
```
creative, interact, shout
```

Esto fue descubierto cuando el usuario **juju** (y otros como lucia, gabo87) no podian volar a pesar de que `default_privs` incluia `fly`.

### Causa Raiz

1. **VoxeLibre sobreescribe `default_privs`**: El juego base ignora la configuracion del engine y aplica su propio set minimo de privilegios.
2. **Privilegios de mods no cargados**: Si `default_privs` incluye privilegios de mods no habilitados en `world.mt` (ej: `home` de `sethome`, `areas` de `areas`), el engine puede fallar silenciosamente y aplicar solo un subset minimo.

### Configuracion Anterior (NO FUNCIONAL)
```conf
default_privs = interact,shout,give,fly,fast,noclip,home,areas,areas_high_limit,protect,creative
```

Resultado real para nuevos usuarios: `creative, interact, shout` (sin fly, fast, noclip, etc.)

### Solucion Implementada: Mod `wetlands_newplayer`

Se creo el mod `server/mods/wetlands_newplayer/` que usa `minetest.register_on_newplayer()` para otorgar privilegios programaticamente.

**Archivo**: `server/mods/wetlands_newplayer/init.lua`

**Privilegios otorgados automaticamente a cada nuevo jugador**:

| Privilegio | Tecla | Para que sirve |
|-----------|-------|---------------|
| `interact` | - | Colocar/romper bloques |
| `shout` | - | Chatear |
| `fly` | K | Volar libremente |
| `fast` | J | Moverse rapido |
| `noclip` | H | Atravesar bloques |
| `give` | - | Darse items |
| `creative` | - | Modo creativo |
| `spawn` | - | Volver al spawn |

### Habilitacion

El mod debe estar habilitado en `world.mt` (en el VPS):
```
load_mod_wetlands_newplayer = true
```

### Verificacion

1. Crear un usuario de prueba nuevo en el servidor
2. Revisar privilegios:
```bash
docker-compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite \
  "SELECT GROUP_CONCAT(p.privilege, ', ') FROM auth a JOIN user_privileges p ON a.id = p.id WHERE a.name='NOMBRE_USUARIO';"
```
3. Debe mostrar: `creative, fast, fly, give, interact, noclip, shout, spawn`

### Logs del Mod

El mod registra cada asignacion en los logs del servidor:
```
[wetlands_newplayer] Mod cargado - privilegios para nuevos jugadores: fly, fast, noclip, give, spawn, creative, interact, shout
[wetlands_newplayer] Privilegios otorgados a nuevo jugador: gabo2222
```

Para verificar que el mod esta cargado:
```bash
docker-compose logs luanti-server | grep wetlands_newplayer
```

### Como Modificar los Privilegios por Defecto

Editar la tabla `PRIVS` en `server/mods/wetlands_newplayer/init.lua`:

```lua
local PRIVS = {
    fly = true,
    fast = true,
    noclip = true,
    give = true,
    spawn = true,
    creative = true,
    interact = true,
    shout = true,
    -- Agregar nuevos privilegios aqui, ej:
    -- teleport = true,
    -- home = true,  -- Solo si el mod sethome esta cargado
}
```

Luego desplegar al VPS y reiniciar el servidor.

### Otorgar Privilegios a Usuarios Existentes (Retroactivo)

Para usuarios que se registraron ANTES de que el mod estuviera activo:

```bash
# Obtener ID del usuario
docker-compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite \
  "SELECT id, name FROM auth WHERE name='USUARIO';"

# Otorgar privilegios faltantes (reemplazar ID_NUM)
docker-compose exec -T luanti-server sqlite3 /config/.minetest/worlds/world/auth.sqlite \
  "INSERT OR IGNORE INTO user_privileges (id, privilege) VALUES
  (ID_NUM,'fly'),(ID_NUM,'fast'),(ID_NUM,'noclip'),(ID_NUM,'give'),(ID_NUM,'spawn');"

# Reiniciar servidor
docker-compose restart luanti-server
```

### Leccion Aprendida

> **NUNCA confiar en `default_privs` de minetest.conf cuando se usa VoxeLibre.** Siempre usar un mod con `register_on_newplayer()` para garantizar que los privilegios se apliquen correctamente. El setting `default_privs` se mantiene en luanti.conf como documentacion/fallback pero no tiene efecto real.